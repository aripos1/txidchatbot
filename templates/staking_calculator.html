<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>스테이킹 보상 계산기</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    {% include "nav.html" %}
    <style>
        :root {
            /* explorer_ui.html의 색상 시스템 반영 */
            --primary-color: #4a90e2;
            --primary-hover: #357ABD;
            --secondary-color: #f0f2f5;
            --accent-color: #5bc0de;
            --text-primary: #34495e;
            --text-secondary: #7f8c8d;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --card-bg: #ffffff;
            --card-border: #e0e6ed;
            --input-border: #dcdfe6;
            --input-focus: #a8d5ff;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 1.5rem;
            padding-top: 80px; /* 헤더 높이만큼 상단 패딩 추가 */
        }

        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2.5rem;
            background-color: var(--card-bg);
            border-radius: 1.25rem;
            box-shadow: var(--shadow-lg);
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            letter-spacing: -0.025em;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.15rem;
            max-width: 650px;
            margin: 0 auto;
        }

        .calculator-section {
            background-color: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem 2rem 1.5rem 2rem;
            box-shadow: var(--shadow-sm);
            margin-bottom: 2rem;
        }

        .coin-selector {
            margin-bottom: 1.5em;
            padding: 0.8em;
            background: var(--secondary-color);
            border-radius: 0.8em;
            border: 1px solid var(--card-border);
        }

        .coin-selector-title {
            font-size: 1.05em;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.8em;
            padding-left: 0.3em;
        }

        .coin-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.6em;
            padding: 0.3em;
        }

        .coin-button {
            padding: 0.7em 0.9em;
            font-size: 0.95em;
            border: 1.5px solid #e0e0e0;
            border-radius: 0.5em;
            background-color: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-weight: 500;
            white-space: nowrap;
        }

        .coin-button:hover {
            border-color: var(--primary-color);
            background-color: #eaf6ff;
        }

        .coin-button.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: 600;
        }

        .coin-button.selected:hover {
            background-color: var(--primary-hover);
        }

        .coin-info {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1.2rem;
            margin-bottom: 1.2rem;
            padding: 1.1rem 1rem 0.7rem 1rem;
            background-color: var(--secondary-color);
            border-radius: 0.8rem;
            box-shadow: var(--shadow-sm);
            flex-direction: column;
        }

        .coin-info-row {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-end;
            justify-content: space-between;
            gap: 1.2rem;
            width: 100%;
            margin-bottom: 0.7em;
        }

        .coin-info-item {
            flex: 1 1 180px;
            min-width: 180px;
        }

        .coin-info-btn-wrap {
            display: inline-block;
            margin-left: 0.7em;
            vertical-align: middle;
        }

        .coin-info-btn {
            display: inline-block;
            padding: 0.35em 1.1em;
            font-size: 0.98em;
            background: #fff;
            color: var(--primary-color);
            border: 1.5px solid var(--primary-color);
            border-radius: 1.2em;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.18s, color 0.18s, border 0.18s;
            box-shadow: none;
            text-align: center;
            letter-spacing: 0.01em;
        }

        .coin-info-btn:hover {
            background: #eaf6ff;
            color: #357ABD;
            border-color: #357ABD;
        }

        .coin-info-label {
            font-size: 0.98rem;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .coin-info-value {
            font-size: 1.13rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .coin-info-item button:hover {
            background: #218c4a;
        }

        .coin-info .coin-info-item:last-child {
            flex-basis: 100%;
            margin-top: 0.7em;
            font-size: 0.97em;
            color: #888;
        }

        .calendar-section {
            background-color: var(--card-bg);
            border-radius: 1rem;
            padding: 1.2rem 1.2rem 0.7rem 1.2rem;
            box-shadow: var(--shadow-sm);
            margin-bottom: 1.2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.1rem;
        }

        .calendar-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .calendar-nav button {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.3rem;
            cursor: pointer;
            padding: 0.5rem 0.8rem;
            border-radius: 0.6rem;
            transition: background 0.2s;
        }

        .calendar-nav button:hover {
            background-color: var(--secondary-color);
        }

        .calendar-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.3rem;
        }

        .calendar-weekday {
            text-align: center;
            font-weight: 700;
            color: var(--text-secondary);
            padding: 0.5rem 0 0.5rem 0;
            font-size: 1.01rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 0.2rem;
            border-radius: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border: 1.5px solid transparent;
            font-size: 1.05em;
            background: #fff;
        }

        .calendar-day.has-amount {
            background-color: #eaf6ff;
            border-color: var(--primary-color);
        }

        .calendar-day.has-amount div {
            color: var(--primary-color) !important;
            font-weight: 700;
            font-size: 0.97em;
            margin-top: 2px;
        }

        .calendar-day:hover {
            background-color: #f0f2f5;
            border-color: var(--primary-color);
            z-index: 1;
            box-shadow: 0 2px 8px rgba(74,144,226,0.08);
        }

        .calendar-day.selected {
            background: #b7d6f5;
            border: 2px solid var(--primary-hover);
        }

        .calculate-button {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: #fff;
            font-weight: 700;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            box-shadow: 0 2px 8px rgba(74,144,226,0.08);
            margin-top: 1.5rem;
            transition: background 0.2s, box-shadow 0.2s;
            padding: 1rem 0;
            width: 100%;
        }

        .calculate-button:hover {
            background: var(--primary-hover);
            box-shadow: 0 4px 16px rgba(74,144,226,0.12);
        }

        .amount-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .amount-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .amount-modal.active .modal-content {
            animation: popIn 0.2s cubic-bezier(.4,1.4,.6,1) both;
        }

        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-content {
            border: 2px solid #eaf6ff;
            box-shadow: 0 8px 32px rgba(74,144,226,0.08);
            border-radius: 1.1rem;
            padding: 2.2rem 1.5rem 1.5rem 1.5rem;
            width: 95%;
            max-width: 400px;
            background: #fff;
            position: relative;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #eaf6ff;
            margin-bottom: 1.2rem;
        }

        .modal-title {
            color: var(--primary-color);
            font-size: 1.15rem;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            color: #b7d6f5;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.2rem 0.7rem;
            border-radius: 0.5rem;
            transition: background 0.2s, color 0.2s;
        }

        .close-modal:hover {
            background: #eaf6ff;
            color: var(--primary-hover);
        }

        .modal-input label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 1.01rem;
            font-weight: 600;
        }

        .modal-input input {
            width: 100%;
            border: 1.5px solid #b7d6f5;
            background: #f0f2f5;
            font-size: 1.08em;
            border-radius: 0.6rem;
            padding: 0.9rem 1rem;
            margin-bottom: 1.2rem;
            color: var(--text-primary);
        }

        .modal-input input:focus {
            border-color: var(--primary-color);
            background: #fff;
        }

        .modal-actions {
            gap: 0.5rem;
            display: flex;
            justify-content: center;
            margin-top: 0.5rem;
        }

        .modal-button.primary {
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: #fff;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(74,144,226,0.08);
            border: none;
            border-radius: 0.5rem;
            font-size: 1.08em;
            padding: 0.8em 2.2em;
        }

        .modal-button.secondary {
            border: 1.5px solid #b7d6f5;
            color: var(--primary-color);
            background: #fff;
            border-radius: 0.5rem;
            font-size: 1.08em;
            padding: 0.8em 2.2em;
        }

        .modal-button.primary:hover {
            background: var(--primary-hover);
        }

        .modal-button.secondary:hover {
            background: #eaf6ff;
        }

        .modal-error {
            color: var(--error-color);
            font-size: 0.95em;
            margin-bottom: 0.5rem;
        }

        .result-section {
            background-color: var(--card-bg);
            border-radius: 1rem;
            padding: 1.2rem 1.2rem 0.5rem 1.2rem;
            box-shadow: var(--shadow-sm);
            margin-top: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .result-section.active {
            display: block;
        }

        .result-table-wrap {
            overflow-x: auto;
            border-radius: 1rem;
            box-shadow: var(--shadow-sm);
            background: #fff;
        }

        .daily-rewards-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 650px;
            font-size: 1.01em;
        }

        .daily-rewards-table th {
            position: sticky;
            top: 0;
            background: #f0f2f5;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.04em;
            border-bottom: 2px solid #e0e6ed;
            z-index: 2;
            padding: 0.7em 0.5em;
            text-align: left;
        }

        .daily-rewards-table th:nth-child(2),
        .daily-rewards-table th:nth-child(3) {
            text-align: right;
        }

        .daily-rewards-table td {
            padding: 0.7em 0.5em;
            border-bottom: 1px solid #f0f0f0;
            background: #fff;
            vertical-align: middle;
        }

        .daily-rewards-table td:nth-child(2),
        .daily-rewards-table td:nth-child(3) {
            text-align: right;
        }

        .daily-rewards-table td .applied-badge {
            margin-left: 0.3em;
            font-size: 0.97em;
            padding: 0.08em 0.7em 0.08em 0.6em;
        }

        .daily-rewards-table tr.total-row {
            background: #d6eaf8;
            font-weight: 700;
            color: var(--primary-color);
            border-top: 2px solid #b7d6f5;
        }

        .daily-rewards-table tr.week-group {
            border-top: 2px solid #b7d6f5;
        }

        .daily-rewards-table tr:last-child td {
            border-bottom: none;
        }

        .daily-rewards-table tr:hover td {
            background-color: #f0f2f5;
        }

        .daily-rewards-table td .payout-date {
            color: var(--primary-color);
            font-weight: 700;
        }

        .daily-rewards-table td .payout-date-label {
            color: #888;
            font-weight: 400;
            font-size: 0.97em;
            margin-right: 0.2em;
        }

        .daily-rewards-table td .applied-badge {
            display: inline-block;
            background: #eaf6ff;
            color: var(--primary-color);
            font-weight: 700;
            border-radius: 1rem;
            margin-left: 0.3em;
        }

        .total-row {
            font-weight: 600;
            background-color: var(--secondary-color);
        }

        .applied-amount-badge {
            display: inline-block;
            background: #eaf6ff;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.05em;
            border-radius: 1rem;
            padding: 0.15em 1.1em 0.15em 0.9em;
            margin-right: 0.5em;
            letter-spacing: 0.01em;
        }

        .applied-amount-inherit {
            color: #888;
            font-size: 0.93em;
            margin-left: 0.2em;
        }

        .applied-badge {
            display: inline-block;
            background: #eaf6ff;
            color: var(--primary-color);
            font-weight: 700;
            font-size: 0.98em;
            border-radius: 1rem;
            padding: 0.13em 0.95em 0.13em 0.8em;
            margin-left: 0.5em;
            letter-spacing: 0.01em;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
                padding-top: 90px; /* 모바일 헤더 높이에 맞춤 */
            }
            .container {
                padding: 1.5rem;
                margin: 1rem auto;
            }
            .header h1 {
                font-size: 2rem;
            }
            .header p {
                font-size: 1rem;
            }
            .calculator-section {
                padding: 1.5rem;
            }
            .coin-button {
                font-size: 0.85rem;
                padding: 0.6rem 1rem;
            }
            .calendar-day {
                min-width: 36px;
                min-height: 36px;
                font-size: 0.95em;
            }
            .calendar-grid {
                gap: 0.15rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0.75rem;
                padding-top: 100px;
            }
            .container {
                padding: 1rem;
                margin: 0.5rem auto;
            }
            .header h1 {
                font-size: 1.5rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .calculator-section {
                padding: 1rem;
            }
            .coin-button {
                font-size: 0.75rem;
                padding: 0.5rem 0.8rem;
            }
            .coin-selector-title {
                font-size: 0.95em;
            }
            input[type="number"] {
                font-size: 0.9rem;
            }
            button {
                font-size: 0.9rem;
                padding: 0.7rem 1rem;
            }
        }

        .note-section {
            margin-top: 1.2rem;
            background: linear-gradient(90deg, #eaf6ff 0%, #f0f2f5 100%);
            border-left: 6px solid var(--primary-color);
            border-radius: 0.75rem;
            color: var(--primary-color);
            font-size: 1.01em;
            padding: 1.1rem 1.3rem;
            box-shadow: 0 2px 8px rgba(74,144,226,0.04);
        }

        .note-section b {
            color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>스테이킹 보상 계산기</h1>
            <p>자유형 스테이킹 보상을 계산해보세요</p>
        </div>

        <div class="calculator-section">
             <div class="coin-selector">
                <div class="coin-selector-title">코인 선택</div>
                <div class="coin-list">
                    <button class="coin-button" data-coin="INJ">인젝티브 (INJ)</button>
                    <button class="coin-button" data-coin="TRX">트론 (TRX)</button>
                    <button class="coin-button" data-coin="ETH">이더리움 (ETH)</button>
                    <button class="coin-button" data-coin="KAIA">카이아 (KAIA)</button>
                    <button class="coin-button" data-coin="SOL">솔라나 (SOL)</button>
                    <button class="coin-button" data-coin="ADA">에이다 (ADA)</button>
                    <button class="coin-button" data-coin="A">볼타 (A)</button>
                    <button class="coin-button" data-coin="DOT">폴카닷 (DOT)</button>
                    <button class="coin-button" data-coin="POL">폴리곤 (POL)</button>
                    <button class="coin-button" data-coin="QTUM">퀀텀 (QTUM)</button>
                    <button class="coin-button" data-coin="ATOM">코스모스 (ATOM)</button>
                    <button class="coin-button" data-coin="ORBS">오브스 (ORBS)</button>
                    <button class="coin-button" data-coin="ICX">아이콘 (ICX)</button>
                    <button class="coin-button" data-coin="WAXP">왁스 (WAXP)</button>
                    <button class="coin-button" data-coin="CRO">크로노스 (CRO)</button>
                    <button class="coin-button" data-coin="TFUEL">쎄타퓨엘 (TFUEL)</button>
                </div>
            </div>

            <div class="coin-info" style="display: none;">
                <div class="coin-info-row">
                    <div class="coin-info-item">
                        <span class="coin-info-label">연 보상률</span>
                        <span class="coin-info-value" id="apy">-</span>
                        <span class="coin-info-btn-wrap">
                            <button class="coin-info-btn" onclick="window.open('https://www.bithumb.com/react/staking', '_blank')">최신 연 보상률 확인</button>
                        </span>
                    </div>
                    <div class="coin-info-item">
                        <span class="coin-info-label">최소 보유량</span>
                        <span class="coin-info-value" id="min-amount">-</span>
                    </div>
                </div>
                <div style="flex-basis:100%;margin-top:0.7em;font-size:0.97em;color:#888;">
                    ※ 연 보상률은 2025-06-11 기준으로 등록된 값이며, 실제 연 보상률은 <b>최신 연 보상률 확인</b> 버튼을 눌러 빗썸 공식 페이지에서 반드시 확인하세요.
                </div>
            </div>

            <div class="calendar-section">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button onclick="changeMonth(-1)">◀</button>
                        <span class="calendar-title" id="calendar-title">2024년 3월</span>
                        <button onclick="changeMonth(1)">▶</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- 요일 헤더와 날짜 셀을 모두 JS에서 렌더링 -->
                </div>
            </div>

            <button class="calculate-button" onclick="calculateRewards()">보상 계산하기</button>
        </div>

        <div class="amount-modal" id="amount-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modal-date">날짜 선택</h3>
                    <button class="close-modal" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-input">
                    <label for="amount-input">보유 수량</label>
                    <input type="number" id="amount-input" step="any" min="0" placeholder="보유 수량을 입력하세요">
                </div>
                <div class="modal-actions">
                    <button class="modal-button secondary" onclick="removeAmount()">삭제</button>
                    <button class="modal-button primary" onclick="saveAmount()">저장</button>
                </div>
            </div>
        </div>

        <!-- 예상 보상 영역 (숨김 처리) -->
        <div id="summary-section" style="display:none;">
            <h2>예상 보상</h2>
            <div class="result-grid">
                <div class="result-item">
                    <div class="result-label">총 보상</div>
                    <div class="result-value" id="total-reward">-</div>
                </div>
                <div class="result-item">
                    <div class="result-label">평균 일일 보상</div>
                    <div class="result-value" id="avg-daily-reward">-</div>
                </div>
                <div class="result-item">
                    <div class="result-label">평균 주간 보상</div>
                    <div class="result-value" id="avg-weekly-reward">-</div>
                </div>
                <div class="result-item">
                    <div class="result-label">평균 월간 보상</div>
                    <div class="result-value" id="avg-monthly-reward">-</div>
                </div>
            </div>
        </div>

        <div style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem; font-size: 1.1rem; color: var(--text-primary);">일별 보상 내역</h3>
            <div style="overflow-x: auto;">
                <table class="daily-rewards-table">
                    <thead>
                        <tr>
                            <th>날짜</th>
                            <th>입력 수량</th>
                            <th>일일 보상<br><span style='font-weight:400;font-size:0.9em;'>(적용: 전일/당일 중 적은 수량)</span></th>
                            <th>지급 예정일</th>
                        </tr>
                    </thead>
                    <tbody id="daily-rewards-body">
                    </tbody>
                </table>
            </div>
        </div>
        <div class="note-section" style="margin-top:2rem;background:#f8f9fa;padding:1.5rem;border-radius:0.75rem;color:#222;">
            <b>※ 빗썸 자유형 스테이킹 공식 안내</b><br>
            - 일별 보상 산출 기준: <b>전일자와 당일자 중 더 적은 수량</b> × (연 추정 보상률 ÷ 365)<br>
            - 일주일 동안 쌓인 일일 보상은 <b>매주 수요일</b>에 지급 확정 (공휴일 시 익영업일 지급)
        </div>
    </div>

    <script>
        const coinData = {
            'INJ': { apy: 3.04, minAmount: 1, name: '인젝티브' },
            'TRX': { apy: 2.62, minAmount: 30, name: '트론' },
            'ETH': { apy: 0.92, minAmount: 0.002, name: '이더리움' },
            'KAIA': { apy: 1.80, minAmount: 50, name: '카이아' },
            'SOL': { apy: 1.97, minAmount: 0.3, name: '솔라나' },
            'ADA': { apy: 0.63, minAmount: 25, name: '에이다' },
            'A': { apy: 1.22, minAmount: 10, name: '볼타' },
            'DOT': { apy: 2.23, minAmount: 1, name: '폴카닷' },
            'POL': { apy: 0.34, minAmount: 20, name: '폴리곤 에코시스템 토큰' },
            'QTUM': { apy: 0.89, minAmount: 5, name: '퀀텀' },
            'ATOM': { apy: 2.62, minAmount: 0.5, name: '코스모스' },
            'ORBS': { apy: 3.31, minAmount: 100, name: '오브스' },
            'ICX': { apy: 2.24, minAmount: 10, name: '아이콘' },
            'WAXP': { apy: 1.66, minAmount: 100, name: '왁스' },
            'CRO': { apy: 0.93, minAmount: 80, name: '크로노스' },
            'TFUEL': { apy: 0.92, minAmount: 200, name: '쎄타퓨엘' }
        };

        let currentDate = new Date();
        let selectedDate = null;
        let dailyAmounts = new Map();
        let selectedCoin = '';

        // 달력 초기화
        function initCalendar() {
            updateCalendarTitle();
            renderCalendar();
        }

        // 달력 제목 업데이트
        function updateCalendarTitle() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            document.getElementById('calendar-title').textContent = `${year}년 ${month}월`;
        }

        // 달력 렌더링
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = firstDay.getDay();
            const totalDays = lastDay.getDate();

            const calendarGrid = document.getElementById('calendar-grid');
            let html = '';
            // 요일 헤더
            const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
            for (let i = 0; i < 7; i++) {
                html += `<div class=\"calendar-weekday\">${weekdays[i]}</div>`;
            }
            // 날짜 셀 (6주 × 7일 = 42칸)
            let dayCount = 1;
            const minAmount = selectedCoin && coinData[selectedCoin] ? coinData[selectedCoin].minAmount : 0;
            for (let cellIndex = 0; cellIndex < 42; cellIndex++) {
                if (cellIndex < startingDay || dayCount > totalDays) {
                    html += '<div class=\"calendar-day other-month\"></div>';
                } else {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(dayCount).padStart(2, '0')}`;
                    let classes = 'calendar-day';
                    let amountText = '';
                    if (dailyAmounts.has(dateStr)) {
                        classes += ' has-amount';
                        const val = dailyAmounts.get(dateStr);
                        if (val !== undefined && val !== null && val !== '') {
                            amountText = `<div style=\"font-size:0.85em;color:var(--primary-color);margin-top:2px;\">${val}</div>`;
                        }
                    }
                    const today = new Date();
                    if (year === today.getFullYear() && month === today.getMonth() && dayCount === today.getDate()) {
                        classes += ' today';
                    }
                    html += `<div class=\"${classes}\" onclick=\"openModal('${dateStr}')\">${dayCount}${amountText}</div>`;
                    dayCount++;
                }
            }
            calendarGrid.innerHTML = html;
        }

        // 월 변경
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            initCalendar();
        }

        // 모달 열기
        function openModal(dateStr) {
            selectedDate = dateStr;
            const modal = document.getElementById('amount-modal');
            const modalDate = document.getElementById('modal-date');
            const amountInput = document.getElementById('amount-input');
            const removeButton = document.querySelector('.modal-button.secondary');

            modalDate.textContent = dateStr;
            amountInput.value = dailyAmounts.get(dateStr) || '';
            removeButton.style.display = dailyAmounts.has(dateStr) ? 'block' : 'none';

            if (selectedCoin) {
                amountInput.min = coinData[selectedCoin].minAmount;
                amountInput.placeholder = `최소 ${coinData[selectedCoin].minAmount} ${selectedCoin} 이상 입력`;
            }

            modal.classList.add('active');
            amountInput.focus();
        }

        // 모달 닫기
        function closeModal() {
            document.getElementById('amount-modal').classList.remove('active');
            selectedDate = null;
        }

        // 보유 수량 저장
        function saveAmount() {
            const amountInput = document.getElementById('amount-input');
            const amount = parseFloat(amountInput.value);
            // 입력값이 비어있으면 삭제 처리
            if (amountInput.value === '' || isNaN(amount)) {
                dailyAmounts.delete(selectedDate);
                renderCalendar();
                closeModal();
                return;
            }
            dailyAmounts.set(selectedDate, amount);
            renderCalendar();
            closeModal();
        }

        // 보유 수량 삭제
        function removeAmount() {
            dailyAmounts.delete(selectedDate);
            renderCalendar();
            closeModal();
        }

        // DOM이 로드된 후 이벤트 리스너 등록
        document.addEventListener('DOMContentLoaded', function() {
            // 코인 버튼 이벤트 리스너
            document.querySelectorAll('.coin-button').forEach(button => {
                button.addEventListener('click', function() {
                    const coin = this.dataset.coin;
                    selectCoin(coin);
                });
            });
        });

        // 코인 선택 함수
        function selectCoin(coin) {
            selectedCoin = coin;
            // 모든 버튼에서 selected 클래스 제거
            document.querySelectorAll('.coin-button').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.dataset.coin === coin) {
                    btn.classList.add('selected');
                }
            });
            // 코인 정보 업데이트
            updateCoinInfo();
        }

        // 코인 정보 업데이트 함수
        function updateCoinInfo() {
            const coinInfo = document.querySelector('.coin-info');
            const apyElement = document.getElementById('apy');
            const minAmountElement = document.getElementById('min-amount');

            if (!selectedCoin || !coinData[selectedCoin]) {
                coinInfo.style.display = 'none';
                return;
            }

            const selectedCoinData = coinData[selectedCoin];
            apyElement.textContent = `${selectedCoinData.apy}%`;
            minAmountElement.textContent = `${selectedCoinData.minAmount} ${selectedCoin}`;
            coinInfo.style.display = 'flex';
        }

        // 보상 계산
        function calculateRewards() {
            if (!selectedCoin) {
                alert('코인을 선택해주세요.');
                return;
            }

            if (dailyAmounts.size === 0) {
                alert('최소 하나의 날짜에 보유 수량을 입력해주세요.');
                return;
            }

            const apy = coinData[selectedCoin].apy;
            const minAmount = coinData[selectedCoin].minAmount;
            const dailyRate = apy / 365 / 100;
            let totalReward = 0;
            let totalDays = 0;
            let dailyRewards = [];

            // 날짜 범위 전체 생성 (입력된 날짜 중 가장 빠른~가장 늦은 날짜)
            const allDatesArr = Array.from(dailyAmounts.keys()).sort((a, b) => new Date(a) - new Date(b));
            const firstDate = new Date(allDatesArr[0]);
            const lastDate = new Date(allDatesArr[allDatesArr.length - 1]);
            let dateList = [];
            for (let d = new Date(firstDate); d <= lastDate; d.setDate(d.getDate() + 1)) {
                dateList.push(new Date(d));
            }

            // 입력값이 없는 날짜는 0으로 간주
            let prevAmountForMin = 0;
            dateList.forEach((dateObj, idx) => {
                const dateStr = `${dateObj.getFullYear()}-${String(dateObj.getMonth() + 1).padStart(2, '0')}-${String(dateObj.getDate()).padStart(2, '0')}`;
                let inputAmount = dailyAmounts.has(dateStr) ? dailyAmounts.get(dateStr) : 0;
                if (inputAmount < minAmount) inputAmount = 0;
                let appliedAmount = inputAmount;
                // 전일/당일 중 더 적은 값 적용
                let usedAmount = Math.min(prevAmountForMin, appliedAmount);
                if (idx === 0) usedAmount = 0; // 첫날은 전일이 없으므로 0
                const dailyReward = usedAmount * dailyRate;
                totalReward += dailyReward;
                totalDays++;
                dailyRewards.push({
                    date: dateStr,
                    inputAmount: dailyAmounts.has(dateStr) ? dailyAmounts.get(dateStr) : '',
                    appliedAmount: appliedAmount,
                    usedAmount: usedAmount,
                    reward: dailyReward
                });
                prevAmountForMin = appliedAmount;
            });

            // 결과 표시
            const avgDailyReward = totalReward / totalDays;
            document.getElementById('total-reward').textContent = `${totalReward.toFixed(6)} ${selectedCoin}`;
            document.getElementById('avg-daily-reward').textContent = `${avgDailyReward.toFixed(6)} ${selectedCoin}`;
            document.getElementById('avg-weekly-reward').textContent = `${(avgDailyReward * 7).toFixed(6)} ${selectedCoin}`;
            document.getElementById('avg-monthly-reward').textContent = `${(avgDailyReward * 30).toFixed(6)} ${selectedCoin}`;

            // 일별 보상 내역 테이블 업데이트
            const tbody = document.getElementById('daily-rewards-body');
            tbody.innerHTML = '';

            // 지급 예정일 계산 함수
            function getPayoutDate(dateStr) {
                const date = new Date(dateStr);
                const dayOfWeek = date.getDay();
                const monday = new Date(date);
                monday.setDate(date.getDate() - ((dayOfWeek + 6) % 7));
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                const payout = new Date(sunday);
                payout.setDate(sunday.getDate() + 3);
                return `${payout.getFullYear()}-${String(payout.getMonth() + 1).padStart(2, '0')}-${String(payout.getDate()).padStart(2, '0')}`;
            }

            // 주간별로 그룹핑 및 표 렌더링
            let weekInputSum = 0;
            let weekRewardSum = 0;
            let weekPayout = '';
            let prevWeekKey = '';
            dailyRewards.forEach((item, idx) => {
                const payoutDate = getPayoutDate(item.date);
                const weekKey = payoutDate;
                if (prevWeekKey && weekKey !== prevWeekKey) {
                    const sumRow = document.createElement('tr');
                    sumRow.className = 'total-row';
                    sumRow.innerHTML = `
                        <td colspan=4 style='background:#d6f5e3;border-top:2px solid #b7eac7;text-align:right;font-size:1.05em;'>
                            <span style='margin-right:2.5em;'>주간 합계</span>
                            <span style='margin-right:2em;'>${weekInputSum.toFixed(6)} ${selectedCoin}</span>
                            <span style='margin-right:2em;'>${weekRewardSum.toFixed(6)} ${selectedCoin}</span>
                            <span class='payout-date-label'>지급일:</span> <span class='payout-date'>${weekPayout} (수)</span>
                        </td>
                    `;
                    tbody.appendChild(sumRow);
                    weekInputSum = 0;
                    weekRewardSum = 0;
                }
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.date}</td>
                    <td>${item.inputAmount !== undefined && item.inputAmount !== null && item.inputAmount !== '' ? item.inputAmount : '-'} ${selectedCoin}</td>
                    <td>${item.reward.toFixed(6)} ${selectedCoin}
                        <span class='applied-badge'>${item.usedAmount.toFixed(6)} ${selectedCoin}</span>
                    </td>
                    <td><span class='payout-date-label'>지급일:</span> <span class='payout-date'>${payoutDate} (수)</span></td>
                `;
                tbody.appendChild(row);
                weekInputSum += (item.inputAmount || 0);
                weekRewardSum += item.reward;
                weekPayout = payoutDate;
                prevWeekKey = weekKey;
                if (idx === dailyRewards.length - 1) {
                    const sumRow = document.createElement('tr');
                    sumRow.className = 'total-row';
                    sumRow.innerHTML = `
                        <td colspan=4 style='background:#d6f5e3;border-top:2px solid #b7eac7;text-align:right;font-size:1.05em;'>
                            <span style='margin-right:2.5em;'>주간 합계</span>
                            <span style='margin-right:2em;'>${weekInputSum.toFixed(6)} ${selectedCoin}</span>
                            <span style='margin-right:2em;'>${weekRewardSum.toFixed(6)} ${selectedCoin}</span>
                            <span class='payout-date-label'>지급일:</span> <span class='payout-date'>${weekPayout} (수)</span>
                        </td>
                    `;
                    tbody.appendChild(sumRow);
                }
            });

            resultSection.classList.add('active');
        }

        // 페이지 로드 시 달력 초기화
        document.addEventListener('DOMContentLoaded', initCalendar);

        // 오늘 날짜를 YYYY-MM-DD 형식으로 반환 (2025-06-11 고정)
        function getTodayDate() {
            return '2025-06-11';
        }
    </script>
</body>
</html> 