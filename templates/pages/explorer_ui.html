{% extends "base.html" %}

{% block title %}ë¸”ë¡ì²´ì¸ íŠ¸ëœì­ì…˜ íƒìƒ‰ê¸°{% endblock %}

{% block meta_description %}31ê°œ ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ì˜ íŠ¸ëœì­ì…˜ì„ í•œ ë²ˆì— ì¡°íšŒí•˜ê³  í™•ì¸í•˜ì„¸ìš”. Bitcoin, Ethereum, BNB Smart Chain, Polygon ë“± ë‹¤ì–‘í•œ ì²´ì¸ì„ ì§€ì›í•©ë‹ˆë‹¤.{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/explorer.css">
<link rel="stylesheet" href="/static/css/adsense.css">
{% endblock %}

{% block content %}
<div class="page-container" x-data="appData()" x-init="init()">
    <!-- Hero Section -->
    <section class="page-header fade-in">
        <h1 class="page-title">ë¸”ë¡ì²´ì¸ íŠ¸ëœì­ì…˜ íƒìƒ‰ê¸°</h1>
        <p class="page-subtitle">
            31ê°œ ë¸”ë¡ì²´ì¸ ë„¤íŠ¸ì›Œí¬ì˜ íŠ¸ëœì­ì…˜ì„ í•œ ë²ˆì— ê²€ìƒ‰í•˜ê³  í™•ì¸í•˜ì„¸ìš”
        </p>
    </section>

    <!-- AdSense: í—¤ë” ì•„ë˜ ë°°ë„ˆ ê´‘ê³  (728x90) -->
    <div class="adsense-container adsense-header-banner">
        <!-- Google AdSense ê´‘ê³  ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‚½ì…í•˜ì„¸ìš” -->
        <!-- ì˜ˆ: <ins class="adsbygoogle" ...></ins> -->
    </div>

    <!-- Main Content with Sidebar Layout -->
    <div class="adsense-optimized-layout">
        <div class="content-with-sidebar">
            <!-- Main Content Area -->
            <div class="content-main">
                <!-- Search Section -->
                <section class="search-section card fade-in">
                    <div class="search-area">
                        <input 
                            id="txid" 
                            type="text" 
                            class="search-input form-input" 
                            placeholder="íŠ¸ëœì­ì…˜ í•´ì‹œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 0x...) ë˜ëŠ” Enter í‚¤ë¥¼ ëˆ„ë¥´ì„¸ìš”" 
                            @keyup.enter="lookupTx()"
                            autocomplete="off"
                        />
                        <button @click="lookupTx()" class="search-button btn btn-primary">
                            <span>ğŸ”</span>
                            <span>íŠ¸ëœì­ì…˜ ì¡°íšŒ</span>
                        </button>
                    </div>
                </section>

                <!-- Result Area -->
                <section class="result-area card fade-in" id="result"></section>

                <!-- AdSense: ê²°ê³¼ ì•„ë˜ ì¸ë¼ì¸ ë°°ë„ˆ ê´‘ê³  -->
                <div class="adsense-container adsense-inline-banner" id="adsense-below-results" style="display: none;">
                    <!-- Google AdSense ê´‘ê³  ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‚½ì…í•˜ì„¸ìš” -->
                </div>

                <!-- Chain Info Section -->
                <section class="chain-info-section fade-in">
        <!-- Supported Chains -->
        <div class="chain-section card">
            <h2>ì§€ì›í•˜ëŠ” ì²´ì¸</h2>
            <div x-show="isLoadingChains" class="loading">
                ì²´ì¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
            </div>
            <div x-show="!isLoadingChains && supportedChains.length === 0" class="error-message">
                ì§€ì›í•˜ëŠ” ì²´ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
            </div>
            <div class="chain-grid" x-show="!isLoadingChains && supportedChains.length > 0">
                <template x-for="chain in supportedChains" :key="chain.name">
                    <a :href="chain.explorer" target="_blank" rel="noopener noreferrer" class="chain-card">
                        <div class="chain-symbol" x-text="chain.symbol"></div>
                        <div class="chain-name" x-text="chain.name"></div>
                    </a>
                </template>
            </div>
        </div>

        <!-- External Chains -->
        <div class="chain-section card">
            <h2>ì¶”ê°€ ìµìŠ¤í”Œë¡œëŸ¬</h2>
            <a href="https://coinmarketcap.com/ko/" target="_blank" rel="noopener noreferrer" class="cmc-button">
                <img src="https://s2.coinmarketcap.com/static/cloud/img/coinmarketcap_1.svg" alt="CMC Logo">
                <span>CoinMarketCap</span>
            </a>
            <div class="external-chain-list" x-show="externalChains.length > 0">
                <template x-for="chain in externalChains" :key="chain.name">
                    <a :href="chain.explorer" target="_blank" rel="noopener noreferrer" class="external-chain-item">
                        <span class="external-chain-name" x-text="chain.name"></span>
                        <span class="external-chain-arrow">â†’</span>
                    </a>
                </template>
            </div>
        </section>

                <!-- Section Divider with AdSense -->
                <div class="section-divider">
                    <div class="adsense-container adsense-inline-banner">
                        <!-- Google AdSense ê´‘ê³  ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‚½ì…í•˜ì„¸ìš” -->
                    </div>
                </div>

                <!-- Converter Section -->
                <section class="converter-section card fade-in">
        <h2>Base64 to HEX ë³€í™˜ê¸° (TON)</h2>
        <div class="converter-area">
            <div class="input-group">
                <input 
                    id="base64-input" 
                    type="text" 
                    class="converter-input form-input" 
                    placeholder="Base64 ë¬¸ìì—´ì„ ì…ë ¥í•˜ì„¸ìš”" 
                    @keyup.enter="base64ToHex()"
                    autocomplete="off"
                />
                <button @click="base64ToHex()" class="btn btn-primary">
                    ë³€í™˜í•˜ê¸°
                </button>
            </div>
            <div class="output-area" id="converter-output">
                <p class="text-secondary text-center">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </section>
            </div>

            <!-- Sidebar -->
            <aside class="content-sidebar">
                <!-- AdSense: ì‚¬ì´ë“œë°” ìƒë‹¨ ì‚¬ê°í˜• ê´‘ê³  (300x250) -->
                <div class="adsense-container adsense-sidebar">
                    <!-- Google AdSense ê´‘ê³  ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‚½ì…í•˜ì„¸ìš” -->
                    <!-- ë°ìŠ¤í¬í†±: 300x250 ë˜ëŠ” 300x600 -->
                </div>

                <!-- AdSense: ì‚¬ì´ë“œë°” ì¤‘ê°„ ì‚¬ê°í˜• ê´‘ê³  (300x250) -->
                <div class="adsense-container adsense-sidebar adsense-vertical">
                    <!-- Google AdSense ê´‘ê³  ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‚½ì…í•˜ì„¸ìš” -->
                    <!-- ë°ìŠ¤í¬í†±: 300x600 -->
                </div>

                <!-- Quick Links Card -->
                <div class="card fade-in">
                    <h3 class="section-title" style="margin-bottom: var(--space-md); padding-bottom: var(--space-sm); border-bottom: 2px solid var(--border-color-light);">
                        ë¹ ë¥¸ ë§í¬
                    </h3>
                    <nav style="display: flex; flex-direction: column; gap: var(--space-sm);">
                        <a href="/chat" class="btn btn-secondary" style="justify-content: flex-start;">
                            <span>ğŸ’¬</span>
                            <span>AI ì±—ë´‡</span>
                        </a>
                        <a href="https://coinmarketcap.com/ko/" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="justify-content: flex-start;">
                            <span>ğŸ“Š</span>
                            <span>CoinMarketCap</span>
                        </a>
                    </nav>
                </div>
            </aside>
        </div>
    </div>

    <!-- AdSense: í‘¸í„° ìœ„ ë°°ë„ˆ ê´‘ê³  -->
    <div class="adsense-container adsense-inline-banner" style="margin-top: var(--space-3xl);">
        <!-- Google AdSense ê´‘ê³  ì½”ë“œë¥¼ ì—¬ê¸°ì— ì‚½ì…í•˜ì„¸ìš” -->
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function appData() {
    return {
        supportedChains: [],
        externalChains: [],
        isLoading: false,
        isLoadingChains: true,
        error: null,
        init() {
            this.fetchSupportedChains();
            this.externalChains = [
                {name: 'Henesys', explorer: 'https://subnets.avax.network/henesys'},
                {name: 'Paycoin', explorer: 'https://scan.payprotocol.io/'},
                {name: 'Vaulta', explorer: 'https://unicove.com/ko/vaulta'},
                {name: 'POKTscan', explorer: 'https://poktscan.com/'}
            ];
        },
        async fetchSupportedChains() {
            this.isLoadingChains = true;
            try {
                const res = await fetch('/api/chains');
                const data = await res.json();
                this.supportedChains = data.supportedChains || [];
            } catch (err) {
                console.error("ì§€ì› ì²´ì¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", err);
                this.error = "ì§€ì› ì²´ì¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            } finally {
                this.isLoadingChains = false;
            }
        },
        async lookupTx() {
            const txid = document.getElementById("txid").value.trim().replace(/ /g, '');
            const resultDiv = document.getElementById("result");
            
            if (!txid) {
                resultDiv.innerHTML = `
                    <div class="error-message">
                        íŠ¸ëœì­ì…˜ í•´ì‹œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                return;
            }

            this.isLoading = true;
            resultDiv.innerHTML = '<div class="loading">íŠ¸ëœì­ì…˜ì„ ì¡°íšŒí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

            try {
                const res = await fetch(`/api/tx/${txid}`);
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                
                const data = await res.json();
                
                // ë””ë²„ê¹…: API ì‘ë‹µ í™•ì¸
                console.log('API ì‘ë‹µ:', data);

                if (!data.found || !data.results || data.results.length === 0) {
                    resultDiv.innerHTML = `
                        <div class="error-message">
                            ì²´ì¸ì—ì„œ í•´ë‹¹ íŠ¸ëœì­ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŠ¸ëœì­ì…˜ í•´ì‹œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.
                            ${data.message ? `<br><small>${data.message}</small>` : ''}
                        </div>
                    `;
                    // ê²°ê³¼ê°€ ì—†ì„ ë•ŒëŠ” ê´‘ê³  ìˆ¨ê¹€
                    const adsenseBelow = document.getElementById('adsense-below-results');
                    if (adsenseBelow) {
                        adsenseBelow.style.display = 'none';
                    }
                    return;
                }

                // ê²°ê³¼ê°€ ìˆì„ ë•Œ ê´‘ê³  í‘œì‹œ
                const adsenseBelow = document.getElementById('adsense-below-results');
                if (adsenseBelow) {
                    adsenseBelow.style.display = 'flex';
                    // ìŠ¤í¬ë¡¤í•˜ì—¬ ê´‘ê³ ê°€ ë³´ì´ë„ë¡
                    setTimeout(() => {
                        adsenseBelow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 300);
                }

                // ê²°ê³¼ ë Œë”ë§
                const resultsHTML = data.results.map(tx => {
                    // ë””ë²„ê¹…: ê° íŠ¸ëœì­ì…˜ ë°ì´í„° í™•ì¸
                    console.log('íŠ¸ëœì­ì…˜ ë°ì´í„°:', tx);
                    
                    // ë°ì´í„° ê²€ì¦
                    if (!tx || !tx.txid) {
                        console.error('ìœ íš¨í•˜ì§€ ì•Šì€ íŠ¸ëœì­ì…˜ ë°ì´í„°:', tx);
                        return '';
                    }
                    
                    // ì•ˆì „í•œ ë¬¸ìì—´ ì´ìŠ¤ì¼€ì´í”„ (XSS ë°©ì§€)
                    const escapeHtml = (str) => {
                        if (str == null) return '';
                        return String(str)
                            .replace(/&/g, '&amp;')
                            .replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;')
                            .replace(/"/g, '&quot;')
                            .replace(/'/g, '&#039;');
                    };
                    
                    const safeTxid = escapeHtml(tx.txid);
                    const safeFrom = tx.from ? escapeHtml(tx.from) : '';
                    const safeTo = tx.to ? escapeHtml(tx.to) : '';
                    const safeValue = tx.value != null ? escapeHtml(String(tx.value)) : '';
                    const safeBlockNumber = tx.blockNumber != null ? escapeHtml(String(tx.blockNumber)) : '';
                    const safeSymbol = escapeHtml(tx.symbol || tx.chain || 'Unknown');
                    const safeExplorer = escapeHtml(tx.explorer || '');
                    const safeStatus = tx.status ? escapeHtml(tx.status.toLowerCase()) : '';
                    const statusText = tx.status === 'confirmed' ? 'âœ“ í™•ì¸ë¨' : 
                                     tx.status === 'failed' ? 'âœ• ì‹¤íŒ¨' : 
                                     tx.status === 'pending' ? 'â³ ëŒ€ê¸°ì¤‘' : escapeHtml(tx.status || '');
                    
                    return `
                    <div class="transaction-card fade-in">
                        <div class="transaction-header">
                            <div class="transaction-chain">
                                <span class="chain-badge">${safeSymbol}</span>
                                ${tx.status ? `
                                    <span class="transaction-status status-${safeStatus}">
                                        ${statusText}
                                    </span>
                                ` : ''}
                            </div>
                            <a href="${safeExplorer}${safeTxid}" target="_blank" rel="noopener noreferrer" class="transaction-link">
                                <span>íƒìƒ‰ê¸°ì—ì„œ ë³´ê¸°</span>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                    <polyline points="15 3 21 3 21 9"></polyline>
                                    <line x1="10" y1="14" x2="21" y2="3"></line>
                                </svg>
                            </a>
                        </div>

                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">íŠ¸ëœì­ì…˜ ID</span>
                                <div class="info-value">
                                    ${safeTxid}
                                    <button class="copy-button btn btn-sm" onclick="copyToClipboard('${safeTxid.replace(/'/g, "\\'")}', event)">ë³µì‚¬</button>
                                </div>
                            </div>

                            ${tx.from ? `
                                <div class="info-item">
                                    <span class="info-label">ë³´ë‚¸ ì£¼ì†Œ</span>
                                    <div class="info-value">
                                        ${safeFrom}
                                        <button class="copy-button btn btn-sm" onclick="copyToClipboard('${safeFrom.replace(/'/g, "\\'")}', event)">ë³µì‚¬</button>
                                    </div>
                                </div>
                            ` : ''}

                            ${tx.to ? `
                                <div class="info-item">
                                    <span class="info-label">ë°›ëŠ” ì£¼ì†Œ</span>
                                    <div class="info-value">
                                        ${safeTo}
                                        <button class="copy-button btn btn-sm" onclick="copyToClipboard('${safeTo.replace(/'/g, "\\'")}', event)">ë³µì‚¬</button>
                                    </div>
                                </div>
                            ` : ''}

                            ${tx.value != null ? `
                                <div class="info-item">
                                    <span class="info-label">ê¸ˆì•¡</span>
                                    <div class="info-value">${safeValue}</div>
                                </div>
                            ` : ''}

                            ${tx.blockNumber != null ? `
                                <div class="info-item">
                                    <span class="info-label">ë¸”ë¡ ë²ˆí˜¸</span>
                                    <div class="info-value">${safeBlockNumber}</div>
                                </div>
                            ` : ''}

                            ${tx.destination_tag != null ? `
                                <div class="info-item">
                                    <span class="info-label">Destination Tag</span>
                                    <div class="info-value">
                                        ${escapeHtml(String(tx.destination_tag))}
                                        <button class="copy-button btn btn-sm" onclick="copyToClipboard('${escapeHtml(String(tx.destination_tag)).replace(/'/g, "\\'")}', event)">ë³µì‚¬</button>
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        ${tx.note ? `
                            <div class="transaction-note">
                                ${escapeHtml(tx.note)}
                            </div>
                        ` : ''}
                    </div>
                `;
                }).filter(html => html !== '').join(''); // ë¹ˆ ë¬¸ìì—´ ì œê±°
                
                if (!resultsHTML || resultsHTML.trim() === '') {
                    console.error('ê²°ê³¼ HTMLì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                    resultDiv.innerHTML = `
                        <div class="error-message">
                            ê²°ê³¼ë¥¼ ë Œë”ë§í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
                        </div>
                    `;
                    return;
                }
                
                console.log('ë Œë”ë§í•  HTML ê¸¸ì´:', resultsHTML.length);
                console.log('resultDiv ìš”ì†Œ:', resultDiv);
                console.log('resultDiv í˜„ì¬ ë‚´ìš© ê¸¸ì´:', resultDiv.innerHTML.length);
                
                // ê¸°ì¡´ ë‚´ìš© í´ë¦¬ì–´
                resultDiv.innerHTML = '';
                
                // HTML ì‚½ì… (í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ)
                try {
                    resultDiv.innerHTML = resultsHTML;
                    
                    // fade-in ì• ë‹ˆë©”ì´ì…˜ í™œì„±í™” (fade-in-visible í´ë˜ìŠ¤ ì¶”ê°€)
                    // requestAnimationFrameì„ ì‚¬ìš©í•˜ì—¬ DOM ì—…ë°ì´íŠ¸ í›„ í´ë˜ìŠ¤ ì¶”ê°€
                    requestAnimationFrame(() => {
                        const transactionCards = resultDiv.querySelectorAll('.transaction-card.fade-in');
                        transactionCards.forEach((card, index) => {
                            // ê° ì¹´ë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í‘œì‹œ
                            setTimeout(() => {
                                card.classList.add('fade-in-visible');
                            }, index * 50); // 50ms ê°„ê²©ìœ¼ë¡œ ìˆœì°¨ í‘œì‹œ
                        });
                    });
                    
                    // ì‚½ì… í›„ í™•ì¸
                    console.log('ì‚½ì… í›„ resultDiv ë‚´ìš© ê¸¸ì´:', resultDiv.innerHTML.length);
                    console.log('ì‚½ì… í›„ resultDiv ìì‹ ìš”ì†Œ ê°œìˆ˜:', resultDiv.children.length);
                    
                    if (resultDiv.children.length === 0) {
                        console.error('ê²½ê³ : HTMLì´ ì‚½ì…ë˜ì—ˆì§€ë§Œ ìì‹ ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.');
                        console.error('ì‚½ì…ëœ HTML (ì²˜ìŒ 500ì):', resultsHTML.substring(0, 500));
                    }
                    
                    const computedStyle = window.getComputedStyle(resultDiv);
                    console.log('ì‚½ì… í›„ resultDiv í‘œì‹œ ìƒíƒœ:', {
                        display: computedStyle.display,
                        visibility: computedStyle.visibility,
                        opacity: computedStyle.opacity,
                        height: computedStyle.height,
                        offsetHeight: resultDiv.offsetHeight,
                        scrollHeight: resultDiv.scrollHeight
                    });
                    
                    // ì²« ë²ˆì§¸ ìì‹ ìš”ì†Œ í™•ì¸
                    if (resultDiv.firstElementChild) {
                        const firstChild = resultDiv.firstElementChild;
                        const firstChildStyle = window.getComputedStyle(firstChild);
                        console.log('ì²« ë²ˆì§¸ ìì‹ ìš”ì†Œ:', {
                            tagName: firstChild.tagName,
                            className: firstChild.className,
                            display: firstChildStyle.display,
                            opacity: firstChildStyle.opacity,
                            visibility: firstChildStyle.visibility,
                            height: firstChild.offsetHeight
                        });
                    }
                    
                } catch (e) {
                    console.error('HTML ì‚½ì… ì¤‘ ì˜¤ë¥˜:', e);
                    resultDiv.innerHTML = `
                        <div class="error-message">
                            ê²°ê³¼ë¥¼ í‘œì‹œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${e.message}
                        </div>
                    `;
                    return;
                }
                
                // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            } catch (error) {
                console.error("ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                resultDiv.innerHTML = `
                    <div class="error-message">
                        ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                        <br><small>${error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}</small>
                    </div>
                `;
                // ê²°ê³¼ê°€ ì—†ì„ ë•ŒëŠ” ê´‘ê³  ìˆ¨ê¹€
                const adsenseBelow = document.getElementById('adsense-below-results');
                if (adsenseBelow) {
                    adsenseBelow.style.display = 'none';
                }
            } finally {
                this.isLoading = false;
            }
        },
        base64ToHex() {
            const base64Input = document.getElementById("base64-input").value.trim();
            const outputArea = document.getElementById("converter-output");
            
            if (!base64Input) {
                outputArea.innerHTML = `
                    <div class="error-message">
                        Base64 ë¬¸ìì—´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                return;
            }

            try {
                const binaryString = atob(base64Input);
                let hexString = "";

                for (let i = 0; i < binaryString.length; i++) {
                    const byte = binaryString.charCodeAt(i);
                    const hexByte = byte.toString(16).padStart(2, '0');
                    hexString += hexByte;
                }
                
                const hexResult = hexString.toUpperCase();

                outputArea.innerHTML = `
                    <div class="result-item fade-in">
                        <span class="result-label">ì…ë ¥ Base64</span>
                        <div class="result-value">
                            ${base64Input}
                            <button class="copy-button btn btn-sm" onclick="copyToClipboard('${base64Input}', event)">ë³µì‚¬</button>
                        </div>
                    </div>
                    <div class="result-item fade-in">
                        <span class="result-label">HEX ê²°ê³¼</span>
                        <div class="result-value">
                            ${hexResult}
                            <button class="copy-button btn btn-sm" onclick="copyToClipboard('${hexResult}', event)">ë³µì‚¬</button>
                        </div>
                    </div>
                `;
            } catch (e) {
                outputArea.innerHTML = `
                    <div class="error-message">
                        ìœ íš¨í•˜ì§€ ì•Šì€ Base64 ë¬¸ìì—´ì…ë‹ˆë‹¤.
                        <br><small>${e.message || 'ë””ì½”ë”© ì˜¤ë¥˜'}</small>
                    </div>
                `;
                console.error("Base64 ë””ì½”ë”© ì˜¤ë¥˜:", e);
            }
        }
    };
}

async function copyToClipboard(text, event) {
    let success = false;
    try {
        await navigator.clipboard.writeText(text);
        success = true;
    } catch (err) {
        console.warn('Async Clipboard API not available, falling back to execCommand:', err);
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.left = "-999999px";
        textArea.style.top = "-999999px";
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
            document.execCommand('copy');
            success = true;
        } catch (execErr) {
            console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', execErr);
            alert("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        } finally {
            document.body.removeChild(textArea);
        }
    }

    if (success) {
        const button = event.target.closest('button');
        if (button) {
            const originalText = button.textContent;
            button.classList.add('copied');
            button.textContent = 'âœ“ ë³µì‚¬ë¨';
            setTimeout(() => {
                button.classList.remove('copied');
                button.textContent = originalText;
            }, 2000);
        }
    }
}
</script>
{% endblock %}
